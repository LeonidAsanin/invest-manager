<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>My Account</title>
</head>
<body>
    <h1>Invest Manager</h1>

    <div th:text="${username} + ', hello!'">Username, hello!</div>

    <br>

    <div>
        Sort by
        <form th:action="@{/account}">
            <span>
                <select name="sortType" onchange="javascript:this.form.submit()">
                    <option value="NONE" th:selected="${sortType} == 'NONE'">none</option>
                    <option value="NAME" th:selected="${sortType} == 'NAME'">name</option>
                    <option value="DATE" th:selected="${sortType} == 'DATE'">date</option>
                </select>
            </span>
            <span>
                <input type="radio" id="asc_order" name="sortOrderType" value="ASC" checked
                       th:checked="${sortOrderType} == 'ASC'" onclick="javascript:this.form.submit()">
                <label for="asc_order">Ascending order</label>

                <input type="radio" id="dec_order" name="sortOrderType" value="DEC"
                       th:checked="${sortOrderType} == 'DEC'" onclick="javascript:this.form.submit()">
                <label for="dec_order">Decreasing order</label>
            </span>
        </form>
    </div>

    <br>

    <div>
        <form th:action="@{/account}">
            <input type="text" name="filter" th:value="${filterByNameString}" placeholder="Filter by name">
            <button type="submit" th:formaction="@{/account}">Apply</button>
        </form>
        <form th:action="@{/account}">
            <input type="text" name="filter" value="" hidden>
            <button type="submit" th:if="${filterByNameString} != ''">Cancel</button>
        </form>
    </div>

    <table>
        <caption>Purchase list</caption>

        <thead>
            <tr>
                <th>Name</th>
                <th>Price of buying</th>
                <th>Amount</th>
                <th>Commission</th>
                <th>Date</th>
                <th>Current price</th>
            </tr>
        </thead>

        <tbody>
            <tr th:each="purchase : ${purchaseList}">
                <form method="post">
                    <td>
                        <input type="text" required th:disabled="${editable_purchase} != ${purchase.id}"
                               name="name" th:value="${purchase.name}">
                    </td>
                    <td>
                        <input type="number" required min="0" step="any" th:disabled="${editable_purchase} != ${purchase.id}"
                               name="price" th:value="${purchase.price}">
                    </td>
                    <td>
                        <input type="number" required min="1" step="1" th:disabled="${editable_purchase} != ${purchase.id}"
                               name="amount" th:value="${purchase.amount}">
                    </td>
                    <td>
                        <input type="number" required min="0" step="any" th:disabled="${editable_purchase} != ${purchase.id}"
                               name="commission" th:value="${purchase.commission}">
                    </td>
                    <td>
                        <input type="date" required th:disabled="${editable_purchase} != ${purchase.id}"
                               name="date" th:value="${purchase.date}">
                    </td>
                    <td>
                        <input type="number" required min="0" step="any" th:disabled="${editable_purchase} != ${purchase.id}"
                               name="currentPrice" th:value="${purchase.currentPrice}">
                    </td>
                    <td>
                        <button type="submit" th:formaction="@{'/purchase/edit/' + ${purchase.id}}"
                                th:if="${editable_purchase} != ${purchase.id}">
                            Edit
                        </button>
                        <button type="submit" th:formaction="@{'/purchase/save/' + ${purchase.id}}"
                                th:if="${editable_purchase} == ${purchase.id}">
                            Save
                        </button>
                    </td>
                    <td>
                        <button type="submit" th:formaction="@{'/purchase/delete/' + ${purchase.id}}">
                            Delete
                        </button>
                    </td>
                    <td class="errorMessage" th:if="${error} == 'editPurchase' AND ${errorId} == ${purchase.id}">
                        Sorry, but you cannot update the purchase with given values and date
                        <a th:href="@{/account}">
                            <button type="button">OK</button>
                        </a>
                    </td>
                    <td class="errorMessage" th:if="${error} == 'deletePurchase' AND ${errorId} == ${purchase.id}">
                        Sorry, but you cannot delete this purchase
                        <a th:href="@{/account}">
                            <button type="button">OK</button>
                        </a>
                    </td>
                </form>
            </tr>
        </tbody>
    </table>

    <br>

    <form method="post" th:action="@{/purchase/add}" th:object="${purchase}">
        <fieldset>
            <label for="purchase_name">Name</label>
            <input type="text" required id="purchase_name" th:field="*{name}">

            <label for="purchase_price">Price of buying</label>
            <input type="number" required min="0" step="any" id="purchase_price" th:field="*{price}">

            <label for="purchase_amount">Amount</label>
            <input type="number" required min="1" step="1" id="purchase_amount" th:field="*{amount}">

            <label for="purchase_commission">Commission</label>
            <input type="number" required min="0" step="any" id="purchase_commission" th:field="*{commission}">

            <label for="purchase_date">Date</label>
            <input type="date" required id="purchase_date" th:field="*{date}">

            <label for="purchase_current_price">Current price</label>
            <input type="number" required min="0" step="any" id="purchase_current_price" th:field="*{currentPrice}">

            <input hidden th:field="*{owner}">

            <button type="submit">Add new purchase</button>
        </fieldset>
    </form>

    <br><br>

    <table>
        <caption>Sale list</caption>

        <thead>
        <tr>
            <th>Name</th>
            <th>Price of selling</th>
            <th>Amount</th>
            <th>Commission</th>
            <th>Date</th>
            <th>Absolute benefit</th>
            <th>Relative benefit</th>
        </tr>
        </thead>


        <tbody>
        <tr th:each="sale : ${saleList}">
            <form method="post">
                <td>
                    <input type="text" required th:disabled="${editable_sale} != ${sale.id}"
                           name="name" th:value="${sale.name}">
                </td>
                <td>
                    <input type="number" required min="0" step="any" th:disabled="${editable_sale} != ${sale.id}"
                           name="price" th:value="${sale.price}">
                </td>
                <td>
                    <input type="number" required min="1" step="1" th:disabled="${editable_sale} != ${sale.id}"
                           name="amount" th:value="${sale.amount}">
                </td>
                <td>
                    <input type="number" required min="0" step="any" th:disabled="${editable_sale} != ${sale.id}"
                           name="commission" th:value="${sale.commission}">
                </td>
                <td>
                    <input type="date" required th:disabled="${editable_sale} != ${sale.id}"
                           name="date" th:value="${sale.date}">
                </td>
                <td>
                    <span th:text="${sale.absoluteBenefit}"></span>
                </td>
                <td>
                    <span th:text="${sale.relativeBenefit}"></span>
                </td>
                <td>
                    <button type="submit" th:formaction="@{'/sale/edit/' + ${sale.id}}"
                            th:if="${editable_sale} != ${sale.id}">
                        Edit
                    </button>
                    <button type="submit" th:formaction="@{'/sale/save/' + ${sale.id}}"
                            th:if="${editable_sale} == ${sale.id}">
                        Save
                    </button>
                </td>
                <td>
                    <button type="submit" th:formaction="@{'/sale/delete/' + ${sale.id}}">
                        Delete
                    </button>
                </td>
                <td class="errorMessage" th:if="${error} == 'editSale' AND ${errorId} == ${sale.id}">
                    Sorry, but you cannot update the sale with given values and date
                    <a th:href="@{/account}">
                        <button type="button">OK</button>
                    </a>
                </td>
            </form>
        </tr>
        </tbody>
    </table>

    <br>

    <form method="post" th:action="@{/sale/add}" th:object="${sale}">
        <fieldset>
            <label for="sale_name">Name</label>
            <input type="text" required id="sale_name" name="name" th:field="*{name}">

            <label for="sale_price">Price of selling</label>
            <input type="number" required min="0" step="any" id="sale_price" th:field="*{price}">

            <label for="sale_amount">Amount</label>
            <input type="number" required min="1" step="1" id="sale_amount" th:field="*{amount}">

            <label for="sale_commission">Commission</label>
            <input type="number" required min="0" step="any" id="sale_commission" th:field="*{commission}">

            <label for="sale_date">Date</label>
            <input type="date" required id="sale_date" th:field="*{date}">

            <input hidden th:field="*{seller}">

            <button type="submit">Add new sale</button>
        </fieldset>
    </form>

    <br>

    <div class="errorMessage" th:if="${error} == 'addSale'">
        <form th:action="@{/account}">
            Sorry, but you cannot add sale with given values and date.
            <button type="submit">OK</button>
        </form>
    </div>

    <br>

    <form th:action="@{/}">
        <input hidden name="logout">
        <button type="submit">Log out</button>
    </form>
</body>
</html>